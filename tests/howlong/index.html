<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>When Can I Leave?</title>
    <style>
        @import url('https://fonts.googleapis.com/css?family=Open+Sans');
        * {
            font-family: 'Open Sans';
            font-weight: 100;
            margin: 0;
        }
        h1,
        h2 {
            font-size: 50px;
            margin: 50px 25px 25px;
        }
        h2 {
            font-size: 30px;
        }
        p {
            font-size: 15px;
        }
        .bar {
            background-color: #eee;
            height: 50px;
            margin: 0 25px;
            position: relative;
            width: calc(100% - 50px);
            z-index: 0;
        }
        .bar p {
            bottom: 8.75px;
            font-size: 25px;
            margin: 0;
            opacity: 0.625;
            position: absolute;
            right: 10px;
        }
        .bar p:first-child {
            left: 10px;
        }
        .bar div {
            bottom: 0;
            position: absolute;
            top: 0;
            z-index: -1;
        }
        .last {
            background-color: #000;
            bottom: calc(100% / 3) !important;
            opacity: 0.125;
            top: calc(100% / 3) !important;
        }
        .bottom {
            display: flex;
            margin: 10px 50px 20px;
        }
        .bottom p {
            margin: 0 10px;
            width: 50%;
        }
        .bottom p:first-child {
            text-align: right;
        }
        .bottom span {
            display: inline-block;
            font-size: 20px;
            width: 60px;
        }
    </style>
</head>

<body>
    <h1>The Gunn Progress Bar</h1>
    <h2>This Year</h2>
    <div class="bar" id="0b">
        <p>Quarter</p>
        <p id="0p"></p>
        <div id="0f"></div>
        <div class="last" id="0l"></div>
    </div>
    <div class="bottom">
        <p id="0ml"></p>
        <p id="0mr"></p>
    </div>
    <div class="bar" id="1b">
        <p>Semester</p>
        <p id="1p"></p>
        <div id="1f"></div>
        <div class="last" id="1l"></div>
    </div>
    <div class="bottom">
        <p id="1ml"></p>
        <p id="1mr"></p>
    </div>
    <div class="bar" id="2b">
        <p>Year</p>
        <p id="2p"></p>
        <div id="2f"></div>
        <div class="last" id="2l"></div>
    </div>
    <div class="bottom">
        <p id="2ml"></p>
        <p id="2mr"></p>
    </div>
    <h2>High School</h2>
    <div class="bar" id="3b">
        <p>Freshmen</p>
        <p id="3p"></p>
        <div id="3f"></div>
        <div class="last" id="3l"></div>
    </div>
    <div class="bottom">
        <p id="3ml"></p>
        <p id="3mr"></p>
    </div>
    <div class="bar" id="4b">
        <p>Sophmores</p>
        <p id="4p"></p>
        <div id="4f"></div>
        <div class="last" id="4l"></div>
    </div>
    <div class="bottom">
        <p id="4ml"></p>
        <p id="4mr"></p>
    </div>
    <div class="bar" id="5b">
        <p>Juniors</p>
        <p id="5p"></p>
        <div id="5f"></div>
        <div class="last" id="5l"></div>
    </div>
    <div class="bottom">
        <p id="5ml"></p>
        <p id="5mr"></p>
    </div>
    <div class="bar" id="6b">
        <p>Seniors</p>
        <p id="6p"></p>
        <div id="6f"></div>
        <div class="last" id="6l"></div>
    </div>
    <div class="bottom">
        <p id="6ml"></p>
        <p id="6mr"></p>
    </div>
    <script>
        let sd = [[new Date('2018-10-15T08:25:00'), new Date('2019-01-08T08:25:00'), new Date('2019-03-12T08:25:00')],
                  [new Date('2018-08-13T08:25:00'), new Date('2019-01-08T08:25:00')],
                  [new Date('2018-08-13T08:25:00')],
                  [new Date('2018-08-13T08:25:00')],
                  [new Date('2017-08-14T08:25:00')],
                  [new Date('2016-08-15T08:25:00')],
                  [new Date('2015-08-17T08:25:00')]
                 ];
        let ed = [[new Date('2018-12-21T12:10:00'), new Date('2019-03-08T03:35:00'), new Date('2019-05-31T12:10:00')],
                  [new Date('2018-12-21T12:10:00'), new Date('2019-05-31T12:10:00')],
                  [new Date('2019-05-31T12:10:00')],
                  [new Date('2022-06-03T12:10:00')],
                  [new Date('2021-06-04T12:10:00')],
                  [new Date('2020-05-29T12:10:00')],
                  [new Date('2019-05-31T12:10:00')]
                 ];
        let colors = ['#4c8', '#4aa', '#48c', '#66c', '#84c', '#a4a', '#c48'];
        
        let start = [];
        let end = [];
        let again = [];

        for (let i = 0; i < sd.length; i++) {
            for (let j = sd[i].length - 1; j > -1; j--) {
                if (new Date() - sd[i][j] > 0) {
                    start.push(sd[i][j]);
                    end.push(ed[i][j]);
                    again.push(sd[i][j + 1]);
                    break;
                }
            }
        }

        function loop() {
            let now = new Date();

            for (let i = 0; i < start.length; i++) {
                let percent = (now - start[i]) / (end[i] - start[i]);
                let display = Math.round(1000000000 * percent) / 10000000;
                display = (display < 10 ? '0' + display : display) + '';
                if (percent > 0 && percent < 1) {
                    document.getElementById(i + 'p').innerHTML = display + '0'.repeat(10 - display.length) + '%';
                } else {
                    document.getElementById(i + 'p').innerHTML = 'Done!';
                    percent = 1;
                }

                document.getElementById(i + 'f').style.left = 0;
                document.getElementById(i + 'f').style.right = 100 * (1 - percent) + '%';
                document.getElementById(i + 'f').style.backgroundColor = colors[i];

                let last = Math.floor(percent * 20) / 20;
                let ld = new Date(last * (end[i].getTime() - start[i].getTime()) + start[i].getTime());
                let next = Math.ceil(percent * 20) / 20;
                let nd = new Date(next * (end[i].getTime() - start[i].getTime()) + start[i].getTime());

                nd = percent === 1 ? new Date(again[i]) : nd;

                let lh = ld.getHours() === 0 || ld.getHours() > 11 ? 'PM' : 'AM';
                let nh = nd.getHours() === 0 || nd.getHours() > 11 ? 'PM' : 'AM';

                let mons = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun',
                            'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'
                           ];

                let lt = ld.getHours() % 12 === 0 ? 12 : ld.getHours() % 12;
                let nt = nd.getHours() % 12 === 0 ? 12 : nd.getHours() % 12;

                document.getElementById(i + 'ml').innerHTML = mons[ld.getMonth()] + ' ' + ld.getDate() + ', ' +
                    lt + ':' + ld.getMinutes() + ' ' + lh + '<span>' + (percent === 1 ? 'Last' : last * 100 + '%') +
                    '</span>';
                document.getElementById(i + 'mr').innerHTML = '<span>' + (percent === 1 ? 'Next' : next * 100 + '%') +
                    '</span>' + mons[nd.getMonth()] + ' ' + nd.getDate() + ', ' + nt + ':' + nd.getMinutes() + ' ' + nh;

                if (i > 0) {
                    let back = i > 2 ? 2 : i - 1;

                    let begin = (start[back] - start[i]) / (end[i] - start[i]);
                    let finish = (end[i] - end[back]) / (end[i] - start[i]);
                    let bar = document.getElementById(i + 'l');
                    bar.style.left = begin * 100 + '%';
                    bar.style.right = finish * 100 + '%';
                }
            }

            window.requestAnimationFrame(loop);
        }

        loop();
    </script>
</body>
</html>
