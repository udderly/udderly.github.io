<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>When Can I Leave?</title>
    <style>
        @import url('https://fonts.googleapis.com/css?family=Open+Sans');
        * {
            font-family: 'Open Sans';
            font-weight: 100;
            margin: 0;
        }
        h1,
        h2 {
            font-size: 50px;
            margin: 50px 25px 10px;
        }
        h2 {
            font-size: 30px;
        }
        p {
            font-size: 20px;
            margin: 10px 50px 20px;
        }
        .bar {
            background-color: #eee;
            height: 50px;
            margin: 0 25px;
            position: relative;
            width: calc(100% - 50px);
            z-index: 0;
        }
        .bar p {
            bottom: 8.75px;
            font-size: 25px;
            margin: 0;
            opacity: 0.625;
            position: absolute;
            right: 10px;
        }
        .bar p:first-child {
            left: 10px;
        }
        .bar div {
            bottom: 0;
            position: absolute;
            top: 0;
            z-index: -1;
        }
        .last {
            background-color: #000;
            bottom: calc(100% / 3) !important;
            opacity: 0.125;
            top: calc(100% / 3) !important;
        }
    </style>
</head>

<body>
    <h1>The Gunn / Paly Progress Bar</h1>
    <h2>This Year</h2>
    <div class="bar" id="0b">
        <p>Quarter</p>
        <p id="0p"></p>
        <div id="0f"></div>
        <div class="last" id="0l"></div>
    </div>
    <p id="0m"></p>
    <div class="bar" id="1b">
        <p>Semester</p>
        <p id="1p"></p>
        <div id="1f"></div>
        <div class="last" id="1l"></div>
    </div>
    <p id="1m"></p>
    <div class="bar" id="2b">
        <p>Year</p>
        <p id="2p"></p>
        <div id="2f"></div>
        <div class="last" id="2l"></div>
    </div>
    <p id="2m"></p>
    <h2>High School</h2>
    <div class="bar" id="3b">
        <p>Freshmen</p>
        <p id="3p"></p>
        <div id="3f"></div>
        <div class="last" id="3l"></div>
    </div>
    <p id="3m"></p>
    <div class="bar" id="4b">
        <p>Sophmores</p>
        <p id="4p"></p>
        <div id="4f"></div>
        <div class="last" id="4l"></div>
    </div>
    <p id="4m"></p>
    <div class="bar" id="5b">
        <p>Juniors</p>
        <p id="5p"></p>
        <div id="5f"></div>
        <div class="last" id="5l"></div>
    </div>
    <p id="5m"></p>
    <div class="bar" id="6b">
        <p>Seniors</p>
        <p id="6p"></p>
        <div id="6f"></div>
        <div class="last" id="6l"></div>
    </div>
    <p id="6m"></p>
    <script>
        let start = [new Date('2019-01-08T08:25:00'),
                     new Date('2018-08-13T08:25:00'), 
                     new Date('2018-08-13T08:25:00'),
                     new Date('2018-08-13T08:25:00'),
                     new Date('2017-08-14T08:25:00'),
                     new Date('2016-08-15T08:25:00'),
                     new Date('2015-08-17T08:25:00')
                    ];
        let end = [new Date('2019-05-31T12:10:00'),
                   new Date('2018-12-21T12:10:00'), 
                   new Date('2019-05-31T12:10:00'),
                   new Date('2022-06-03T12:10:00'),
                   new Date('2021-06-04T12:10:00'),
                   new Date('2020-05-29T12:10:00'),
                   new Date('2019-05-31T12:10:00')
                  ];
        let colors = ['#4c8', '#4aa', '#48c', '#66c', '#84c', '#a4a', '#c48'];
        
        function loop() {
            let now = new Date();
            
            for (let i = 0; i < start.length; i++) {
                let percent = (now - start[i]) / (end[i] - start[i]);
                let display = Math.round(1000000000 * percent) / 10000000;
                display = (display < 10 ? '0' + display : display) + '';
                if (percent > 0 && percent < 1) {
                    document.getElementById(i + 'p').innerHTML = display + '0'.repeat(10 - display.length) + '%';
                } else {
                    document.getElementById(i + 'p').innerHTML = percent <= 0 ? 'Not started' : 'Done!';
                }
                
                document.getElementById(i + 'f').style.left = 0;
                document.getElementById(i + 'f').style.right = 100 * (1 - percent) + '%';
                document.getElementById(i + 'f').style.backgroundColor = colors[i];
                
                let last = Math.floor(percent * 20) / 20;
                let ld = new Date(last * (end[i].getTime() - start[i].getTime()) + start[i].getTime());
                let next = Math.ceil(percent * 20) / 20;
                let nd = new Date(next * (end[i].getTime() - start[i].getTime()) + start[i].getTime());
                
                let lh = ld.getHours() === 0 || ld.getHours() > 11 ? 'PM' : 'AM';
                let nh = nd.getHours() === 0 || nd.getHours() > 11 ? 'PM' : 'AM';
                
                let mons = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun',
                            'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'
                           ];
                
                document.getElementById(i + 'm').innerHTML = (last * 100) + '%: ' +
                    mons[ld.getMonth()] + ' ' + ld.getDate() +
                    ', ' + (ld.getHours() % 12) + ':' + ld.getMinutes() + ' ' + lh +
                    '<br>' + (next * 100) + '%: ' +
                    mons[nd.getMonth()] + ' ' + nd.getDate() +
                    ', ' + (nd.getHours() % 12) + ':' + nd.getMinutes() + ' ' + nh;
                
                if (i > 0) {
                    let back = i > 2 ? 2 : i - 1;
                    
                    let begin = (start[back] - start[i]) / (end[i] - start[i]);
                    let finish = (end[i] - end[back]) / (end[i] - start[i]);
                    let bar = document.getElementById(i + 'l');
                    bar.style.left = begin * 100 + '%';
                    bar.style.right = finish * 100 + '%';
                }
            }
            
            window.requestAnimationFrame(loop);
        }
        
        loop();
    </script>
</body>
</html>
